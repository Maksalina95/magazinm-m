<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>–¢–æ–≤–∞—Ä—ã –≤ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ ‚Äî –ú–∞–≥–∞–∑–∏–Ω –ú–∞–∫—Å–∞–ª–∏–Ω—ã</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <div class="container">
    <aside>
      <h2>–ú–µ–Ω—é</h2>
      <a href="index.html">üè† –ì–ª–∞–≤–Ω–∞—è</a>
      <a href="favorites.html">‚≠ê –ò–∑–±—Ä–∞–Ω–Ω–æ–µ</a>
      <a href="delivery.html">üöö –î–æ—Å—Ç–∞–≤–∫–∞</a>
      <a href="contacts.html">üìû –ö–æ–Ω—Ç–∞–∫—Ç—ã</a>
      <a href="address.html">üìç –ê–¥—Ä–µ—Å</a>
      <a href="reviews.html">üó£ –û—Ç–∑—ã–≤—ã</a>
      <a href="#" onclick="location.reload()">üîÑ –û–±–Ω–æ–≤–∏—Ç—å —Å–∞–π—Ç</a>
      <a href="terms.html">üìú –ü—Ä–∞–≤–∏–ª–∞</a>
    </aside>

    <main>
      <h1 id="categoryTitle" style="color: #a63b3b;">–¢–æ–≤–∞—Ä—ã</h1>
      <div id="product-list" class="product-grid"></div>
    </main>
  </div>

  <!-- üîç –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ -->
  <div id="product-modal" style="display:none; position:fixed; top:0;left:0;right:0;bottom:0; background:rgba(0,0,0,0.5); justify-content:center; align-items:center; z-index:1000;">
    <div style="background:white; border-radius:12px; max-width:500px; width:90%; padding:20px; position:relative;">
      <button id="modal-close" style="position:absolute; top:10px; right:10px; font-size:20px; background:none; border:none; cursor:pointer;">√ó</button>
      <div id="modal-content"></div>
    </div>
  </div>

  <script>
    const sheetId = '1gBcuPzWv_nH2i7sWyCaERVCjO-hLg8EcndPkEMlNqgw';
    const url = https://opensheet.elk.sh/${sheetId}/Sheet1;

    const params = new URLSearchParams(window.location.search);
    const selectedCategory = params.get('category');
    document.getElementById('categoryTitle').textContent = selectedCategory;

    const productList = document.getElementById('product-list');
    const modal = document.getElementById('product-modal');
    const modalContent = document.getElementById('modal-content');
    const modalClose = document.getElementById('modal-close');
    modalClose.onclick = () => (modal.style.display = 'none');
    modal.onclick = e => { if (e.target === modal) modal.style.display = 'none'; };

    fetch(url)
      .then(res => res.json())
      .then(data => {
        const filtered = data.filter(item => item.–∫–∞—Ç–µ–≥–æ—Ä–∏—è === selectedCategory);

        if (filtered.length === 0) {
          productList.innerHTML = '<p>–ù–µ—Ç —Ç–æ–≤–∞—Ä–æ–≤ –≤ —ç—Ç–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏.</p>';
          return;
        }

        filtered.forEach(item => {
          const card = document.createElement('div');
          card.className = 'product-card';
          card.innerHTML = `
            ${item.–≤–∏–¥–µ–æ 
              ? <video controls src="${item.–≤–∏–¥–µ–æ}" style="width:100%;border-radius:12px;"></video>
              : <img src="${item.—Ñ–æ—Ç–æ}" alt="${item.–Ω–∞–∑–≤–∞–Ω–∏–µ}" />}
            <h3>${item.–Ω–∞–∑–≤–∞–Ω–∏–µ}</h3>
            ${item.–æ–ø–∏—Å–∞–Ω–∏–µ ? <p>${item.–æ–ø–∏—Å–∞–Ω–∏–µ}</p> : ''}
            <strong>${item.—Ü–µ–Ω–∞} ‚ÇΩ</strong>
            <div class="card-buttons">
              <a href="https://wa.me/79376280080" class="buy-button" target="_blank">–ö—É–ø–∏—Ç—å –≤ WhatsApp</a>
              <button class="fav-btn" data-name="${item.–Ω–∞–∑–≤–∞–Ω–∏–µ}">‚≠ê</button>
            </div>
          `;
          card.addEventListener('click', e => {
            if (e.target.closest('.fav-btn') || e.target.closest('a')) return;
            openModal(item);
          });
          productList.appendChild(card);
        });

        // –ò–∑–±—Ä–∞–Ω–Ω–æ–µ
        document.querySelectorAll('.fav-btn').forEach(btn => {
          btn.addEventListener('click', e => {
            e.stopPropagation();
            const name = btn.dataset.name;
            let favs = JSON.parse(localStorage.getItem('favorites') || '[]');
            if (favs.includes(name)) {
              favs = favs.filter(n => n !== name);
              btn.textContent = '‚≠ê';
            } else {
              favs.push(name);
              btn.textContent = '‚úÖ';
            }
            localStorage.setItem('favorites', JSON.stringify(favs));
          });
        });
      })
      .catch(err => {
        console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ç–æ–≤–∞—Ä–æ–≤:', err);
        productList.innerHTML = '<p>–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ç–æ–≤–∞—Ä–æ–≤.</p>';
      });

    function openModal(product) {
      modalContent.innerHTML = `
        ${product.–≤–∏–¥–µ–æ 
          ? <video controls src="${product.–≤–∏–¥–µ–æ}" style="width:100%;border-radius:12px;"></video> 
          : <img src="${product.—Ñ–æ—Ç–æ}" alt="${product.–Ω–∞–∑–≤–∞–Ω–∏–µ}" style="width:100%;border-radius:12px;" />}
        <h2 style="color:#a63b3b;margin-top:15px;">${product.–Ω–∞–∑–≤–∞–Ω–∏–µ}</h2>
        <p style="white-space:pre-line;">${product.–æ–ø–∏—Å–∞–Ω–∏–µ || ''}</p>
        <strong style="font-size:20px;">${product.—Ü–µ–Ω–∞} ‚ÇΩ</strong>
        <div style="margin-top:15px;">
          <a href="https://wa.me/79376280080" class="buy-button" target="_blank">–°–≤—è–∑–∞—Ç—å—Å—è –≤ WhatsApp</a>
        </div>
      `;
      modal.style.display = 'flex';
    }
  </script>
</body>
</html>
